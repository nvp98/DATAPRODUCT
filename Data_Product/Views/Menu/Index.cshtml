@using Data_Product.Models
@using System.Security.Claims;
@using Data_Product.Repositorys;
@using Microsoft.EntityFrameworkCore;
@inject Data_Product.Repositorys.DataContext _context
@{
    var TenTaiKhoan = User.FindFirstValue(ClaimTypes.Name);
    var TaiKhoan = _context.Tbl_TaiKhoan.Where(x => x.TenTaiKhoan == TenTaiKhoan).FirstOrDefault();
    var PhongBan = _context.Tbl_PhongBan.Where(x => x.ID_PhongBan == TaiKhoan.ID_PhongBan).FirstOrDefault();
    List<string> ListQuyen = new List<string>();
    @if (TaiKhoan.Quyen_Them != null)
    {
        ListQuyen = TaiKhoan.Quyen_Them.Split(',').Select(item => item.Trim()).ToList();
    }
    List<string> QuyenQLy = new List<string> { "1", "2", "3" };

}
@{
    var taiKhoan = (Tbl_TaiKhoan)ViewBag.TaiKhoan;
    List<string> ListQuyenThem = new List<string>();
    @if (taiKhoan.Quyen_Them != null)
    {
        ListQuyenThem = taiKhoan.Quyen_Them.Split(',').Select(item => item.Trim()).ToList();
    }
}
<div class="text-center">
    <section class="section dashboard">
        <div class="row">
            <div class="col-12" style="text-align: left;padding-bottom: 1%; padding-top: 1%;">
                <b>
                    <span class="small pt-1 fw-bold" style="color:#06428b">Biên bản giao nhận</span>

                </b>
            </div><!-- End Recent Sales -->
            <!-- Left side columns -->
            <div class="col-lg-12">
                <div class="row">
                    <!-- Sales Card -->
                    @{
                        List<string> QuyenBBGN = new List<string> { "4" };
                    }
                    @if (QuyenQLy.Any(value => ListQuyen.Contains(value)) || QuyenBBGN.Any(value => ListQuyen.Contains(value)) || TaiKhoan.ID_Quyen == 1 || TaiKhoan.ID_Quyen == 2 || TaiKhoan.ID_Quyen == 3 || TaiKhoan.ID_Quyen == 4)
                    {
                        <div class="col-xxl-3 col-md-6">
                            <div class="card info-card sales-card">
                                <div class="card-body" style="padding: 5px;">

                                    <div class="d-flex align-items-center">
                                        <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                            <img src="~/img/BM.png" style=" width: 45%;" alt="">
                                        </div>
                                        <div class="ps-1">
                                            <a class="nav-link " href="@Url.Action("TaoPhieu","BM_11")" style="font-size: 15px;">
                                                <span class="text-muted small pt-2 ps-1">
                                                    <b>
                                                        BM.11/QT.05 (Biên bản giao nhận nguyên/nhiên/vật tư)
                                                    </b>
                                                </span>
                                            </a>

                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div><!-- End Sales Card -->
                    }
                    @{
                        List<string> valuesToCheck = new List<string> { "9", "1", "3" };
                    }
                    @if (taiKhoan.ID_Quyen == 9 || taiKhoan.ID_Quyen == 1 || taiKhoan.ID_Quyen == 3 || valuesToCheck.Any(value => ListQuyenThem.Contains(value)))
                    {
                        <div class="col-xxl-3 col-md-6">
                            <div class="card info-card sales-card">
                                <div class="card-body" style="padding: 5px;">
                                    <div class="d-flex align-items-center">
                                        <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                            <img src="~/img/BM.png" style=" width: 45%;" alt="">
                                        </div>
                                        <div class="ps-1">
                                            <a class="nav-link" href="@Url.Action("Index", "BM_NhatKy_SanXuat")" style="font-size: 15px;">
                                                <span class="text-muted small pt-2 ps-1">
                                                    <b>BM.12/QT.05 (Nhật ký dừng sản xuất)</b>
                                                </span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                    @{
                        List<string> QuyenGangThep = new List<string> { "11" };
                    }
                    @if (QuyenQLy.Any(value => ListQuyen.Contains(value)) || QuyenGangThep.Any(value => ListQuyen.Contains(value)) && PhongBan.TenNgan == "NM.LG" || TaiKhoan.ID_Quyen == 1 || TaiKhoan.ID_Quyen == 2 || TaiKhoan.ID_Quyen == 3 || TaiKhoan.ID_Quyen == 11 && PhongBan.TenNgan == "NM.LG")
                    {
                        <div class="col-xxl-3 col-md-6">
                            <div class="card info-card sales-card">
                                <div class="card-body" style="padding: 5px;">

                                    <div class="d-flex align-items-center">
                                        <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                            <img src="~/img/BM.png" style=" width: 45%;" alt="">
                                        </div>
                                        <div class="ps-1">
                                            <a class="nav-link " href="@Url.Action("TaoPhieu", "BM16_GangThoi")" style="font-size: 15px;">
                                                <span class="text-muted small pt-2 ps-1">
                                                    <b>
                                                        Quy trình giao nhận Gang lỏng - Luyện gang

                                                    </b>
                                                </span>
                                            </a>

                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    }
                
                    @if (QuyenQLy.Any(value => ListQuyen.Contains(value)) || QuyenGangThep.Any(value => ListQuyen.Contains(value)) && (PhongBan.TenNgan == "NM.HRC1" || PhongBan.TenNgan == "NM.HRC2") || TaiKhoan.ID_Quyen == 1 || TaiKhoan.ID_Quyen == 2 || TaiKhoan.ID_Quyen == 3 || TaiKhoan.ID_Quyen == 11 && (PhongBan.TenNgan == "NM.HRC1" || PhongBan.TenNgan == "NM.HRC2"))
                    {
                        <div class="col-xxl-3 col-md-6">
                            <div class="card info-card sales-card">
                                <div class="card-body" style="padding: 5px;">

                                    <div class="d-flex align-items-center">
                                        <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                            <img src="~/img/BM.png" style=" width: 45%;" alt="">
                                        </div>
                                        <div class="ps-1">
                                            <a class="nav-link " href="@Url.Action("Index", "BM_GangThoi_Thep")" style="font-size: 15px;">
                                                <span class="text-muted small pt-2 ps-1">
                                                    <b>
                                                        Quy trình giao nhận Gang lỏng - Luyện thép
                                                    </b>
                                                </span>
                                            </a>

                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    }
                    <!-- End Sales Card -->
                   @*  } *@
                </div>
            </div><!-- End Left side columns -->
        </div>
        <div class="row">
            <div class="col-12" style="text-align: left;padding-bottom: 1%;">
                <b>
                    <span class="small pt-1 fw-bold" style="color:#06428b">Biên bản giao nhận ( Phiếu bổ sung )</span>

                </b>
            </div><!-- End Recent Sales -->
            <!-- Left side columns -->
            <div class="col-lg-12">
                <div class="row">
                    <!-- Sales Card -->
                    @if (QuyenQLy.Any(value => ListQuyen.Contains(value)) || QuyenBBGN.Any(value => ListQuyen.Contains(value)) || TaiKhoan.ID_Quyen == 1 || TaiKhoan.ID_Quyen == 2 || TaiKhoan.ID_Quyen == 3 || TaiKhoan.ID_Quyen == 4)
                    {
                        <div class="col-xxl-3 col-md-6">
                            <div class="card info-card sales-card">
                                <div class="card-body" style="padding: 5px;">

                                    <div class="d-flex align-items-center">
                                        <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                            <img src="~/img/BM.png" style=" width: 45%;" alt="">
                                        </div>
                                        <div class="ps-1">
                                            <a class="nav-link " href="@Url.Action("BoSungPhieu","BM_11")" style="font-size: 15px;">
                                                <span class="text-muted small pt-2 ps-1">
                                                    <b>
                                                        BM.11/QT.05 (Biên bản giao nhận nguyên/nhiên/vật tư)
                                                    </b>
                                                </span>
                                            </a>

                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div><!-- End Sales Card -->
                    }
                </div>
            </div><!-- End Left side columns -->
        </div>
    </section>
</div>
