@using Data_Product.Models
@using System.Security.Claims;
@using Data_Product.Repositorys;
@using Microsoft.EntityFrameworkCore;
@inject Data_Product.Repositorys.DataContext _context
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
@* @model List<Data_Product.Models.Tbl_BM_16_GangLong> *@

@model Data_Product.DTO.BM_16_DTO.BBGN_GangLong_ViewModel
@* 
@{
    var TenTaiKhoan = User.FindFirstValue(ClaimTypes.Name);
    var TaiKhoan = _context.Tbl_TaiKhoan.Where(x => x.TenTaiKhoan == TenTaiKhoan).FirstOrDefault();
    var PhongBan = _context.Tbl_PhongBan.Where(x => x.ID_PhongBan == TaiKhoan.ID_PhongBan).FirstOrDefault();
    var ViTri = _context.Tbl_ViTri.Where(x => x.ID_ViTri == TaiKhoan.ID_ChucVu).FirstOrDefault();
}

@{
    var total = Model.Sum(x => x.G_KLGangLong);

    var firstItem = Model.FirstOrDefault();
    var phongBan = firstItem.ChuyenDen;

    var taiKhoanList = Model.DistinctBy(x => x.TenTaiKhoan)
    .Select(x => new
    {
        x.TenTaiKhoan,
        x.HoVaTen,
        x.TenViTri,
        x.TenPhongBan,
        x.ChuKy
    }).ToList();

}  *@
@{
    var TenTaiKhoan = User.FindFirstValue(ClaimTypes.Name);
    var TaiKhoan = _context.Tbl_TaiKhoan.FirstOrDefault(x => x.TenTaiKhoan == TenTaiKhoan);
    var PhongBan = _context.Tbl_PhongBan.FirstOrDefault(x => x.ID_PhongBan == TaiKhoan.ID_PhongBan);
    var ViTri = _context.Tbl_ViTri.FirstOrDefault(x => x.ID_ViTri == TaiKhoan.ID_ChucVu);
    var DanhSachThung = Model.DanhSachGangLong ?? new List<Tbl_BM_16_GangLong>();
    var total = DanhSachThung.Sum(x => x.G_KLGangLong);
}
<div style="padding:0px 30px 0px 50px">
    <div>
        <div class="" style="text-align: left;display: flex;margin-bottom:0">
            <div style="flex: 0 0 50%;width:80%;  float: left; font-weight: bold; font-size: 1rem; text-transform: uppercase;">
                <img alt="Hòa Phát Dung Quất" src="https://report.hoaphatdungquat.vn/img/logoHP.png" width="205" />
                <div class="" style="margin-top: 0; font-weight:bold">CÔNG TY CỔ PHẦN THÉP</div>
                <div class="" style="font-weight:bold;margin-left:10px ">HÒA PHÁT DUNG QUẤT</div>
            </div>

            <div style="flex: 0 0 50%;width:20%; float:right;text-align:right; font-weight: bold;">
                <span style="font-weight:bold">BM.16/QT.05.09</span>
                <div style="margin-top:0"><span style="font-style:italic;">Ngày hiệu lực:</span> 01/10/2024</div>
                <div style="margin-top:0"><span style="font-style:italic;">Lần sửa đổi:</span> 01</div>
            </div>
        </div><!-- End Recent Sales -->
        <div style="flex: 0 0 100%; width: 100%; margin-top:0">
            <div style="text-align:center;margin-top:0; font-size: 1.5rem;font-weight:bold; text-transform:uppercase">
                BIÊN BẢN GIAO NHẬN<br />  KHỐI LƯỢNG GANG LỎNG - GANG THỎI
            </div>
        </div>
        <div class="col-md-12 float-left">
            Chúng tôi gồm:
        </div>
        @{
            int stt = 1;
        }
        @foreach(var item in Model.NguoiChuyen)
        {
        <div class="col-md-12 float-left" style="margin:8px 0; display:flex;width:100%">
                <div style="width:37%"> @stt. Đại diện bên giao: Ông/bà:@item.HoVaTen</div>
                <div style="width:38%">Chức vụ:@item.TenViTri </div>
                <div style="width:25%">BP: @item.TenPhongBan</div>
        </div>
            stt++;
        }
   
        @foreach (var item in Model.NguoiNhan)
        {
            <div class="col-md-12 float-left" style="margin:8px 0; display:flex;width:100%">
                <div style="width:37%"> @stt. Đại diện bên nhận: Ông/bà: @item.HoVaTen</div>
                <div style="width:38%">Chức vụ: @item.TenViTri</div>
                <div style="width:25%">BP: @item.TenPhongBan</div>
            </div>
            stt++;
        }
        @foreach(var item in Model.NguoiXacNhan)
        {
            <div class="col-md-12 float-left" style="margin:8px 0; display:flex;width:100%">
                <div style="width:37%"> @stt. Đại diện QLCL: Ông/bà: @item.HoVaTen</div>
                <div style="width:38%">Chức vụ: @item.TenViTri</div>
                <div style="width:25%">BP: @item.TenPhongBan</div>
            </div>
            stt++;
        }
        <div class="col-md-12 float-left" style="margin-bottom:8px;">
            Cùng nhau thống nhất lập "Biên bản gang lỏng - gang thỏi" chi tiết như sau:
        </div>
    </div>

    <div class="card-body" style="padding-top:1%;">
        <div class="table-responsive">
            <table style="border-collapse: collapse; width: 100%; " cellpadding="0" id="tblSoLieu">
                <thead>
                    <tr>
                        <th rowspan="2" style="border: 1px solid black; padding: 8px; text-align: center; vertical-align: middle; font-size: 14px; width: 5%;">STT</th>
                        <th rowspan="2" style="border: 1px solid black; padding: 8px; text-align: center; vertical-align: middle; font-size: 14px; width: 17%;">Số mẻ</th>
                        <th rowspan="2" style="border: 1px solid black; padding: 8px; text-align: center; vertical-align: middle; font-size: 14px; width: 7%;">Thùng số</th>
                        <th rowspan="2" style="border: 1px solid black; padding: 8px; text-align: center; vertical-align: middle; font-size: 14px; width: 8%;">KL xe goong</th>
                        <th rowspan="2" style="border: 1px solid black; padding: 8px; text-align: center; vertical-align: middle; font-size: 14px; width: 8%;">KL thùng</th>
                        <th rowspan="2" style="border: 1px solid black; padding: 8px; text-align: center; vertical-align: middle; font-size: 14px; width: 9%;">KL thùng & gang lỏng (tấn)</th>
                        <th rowspan="2" style="border: 1px solid black; padding: 8px; text-align: center; vertical-align: middle; font-size: 14px; width: 9%;">KL gang lỏng cân ray (tấn)</th>
                        <th colspan="4" style="border: 1px solid black; padding: 8px; text-align: center; vertical-align: middle; font-size: 14px; width: 8%;">Vận chuyển đến</th>
                        <th rowspan="2" style="border: 1px solid black; padding: 8px; text-align: center; vertical-align: middle; font-size: 14px; width: 9%;">Phân loại</th>
                        <th rowspan="2" style="border: 1px solid black; padding: 8px; text-align: center; vertical-align: middle; font-size: 14px; width: 20%;">Ghi chú <br /> <span style="font-weight: 400;">(Thùng tồn tại trong kíp tại NM.LT)</span></th>
                    </tr>
                    <tr>
                        <th style="border: 1px solid black; padding: 8px; text-align: center; vertical-align: middle; font-size: 14px;width: 4%;">NM.HRC1</th>
                        <th style="border: 1px solid black; padding: 8px; text-align: center; vertical-align: middle; font-size: 14px; width: 4%;">NM.HRC2</th>
                        <th style="border: 1px solid black; padding: 8px; text-align: center; vertical-align: middle; font-size: 14px;width: 4%;">ĐÚC1</th>
                        <th style="border: 1px solid black; padding: 8px; text-align: center; vertical-align: middle; font-size: 14px; width: 4%;">ĐÚC2</th>
                    </tr>

                </thead>
                 <tbody>
                    @{

                        int RowNo = 1;
                    }
                    @foreach (var item in DanhSachThung)
                    {
                        <tr>
                            <td class="text-center" style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; padding: 7px 0;">
                                @RowNo@{
                                    RowNo++;
                                }
                            </td>

                            <td style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; padding: 7px 0;">
                                @item.BKMIS_SoMe
                            </td>
                            <td style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; padding: 7px 0;">
                                @item.BKMIS_ThungSo
                            </td>
                            <td style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; padding: 7px 0;">
                                @item.KL_XeGoong
                            </td>
                            <td style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; padding: 7px 0;">
                                @item.G_KLThungChua
                            </td>
                            <td style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; padding: 7px 0;">
                                @item.G_KLThungVaGang
                            </td>
                            <td style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; padding: 7px 0;">
                                @item.G_KLGangLong
                            </td>
                            <td style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; padding: 7px 0;">
                                @if (item.ChuyenDen == "HRC1")
                                {
                                    if (item.KR == true)
                                    {
                                        @:KR
                                    }
                                    else
                                    {
                                        @:x
                                    }
                                }
                            </td>
                            <td style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; padding: 7px 0;">
                                @if (item.ChuyenDen == "HRC2")
                                {
                                    if (item.KR == true)
                                    {
                                        @:KR
                                    }
                                    else
                                    {
                                        @:x
                                    }
                                }
                            </td>
                            <td style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; padding: 7px 0;">
                                @if (item.ChuyenDen == "DUC1")
                                {
                                    if (item.KR == true)
                                    {
                                        @:KR
                                    }
                                    else
                                    {
                                        @:x
                                    }
                                }
                            </td>
                            <td style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; padding: 7px 0;">
                                @if (item.ChuyenDen == "DUC2")
                                {
                                    if (item.KR == true)
                                    {
                                        @:KR
                                    }
                                    else
                                    {
                                        @:x
                                    }
                                }
                            </td>
                            <td style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; padding: 7px 0;">
                                @item.BKMIS_PhanLoai
                            </td>
                            <td style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; padding: 7px 0;">
                                @item.G_GhiChu
                            </td>
                        </tr>
                    }
                </tbody> 
                <tfoot>
                    <tr>
                        <td colspan="6" style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; font-weight: 600;; padding: 7px 0;">
                            Tổng khối lượng
                        </td>
                        <td style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; font-weight: 600; padding: 7px 0;">@total</td>
                        <td colspan="6" style="font-size:14px;vertical-align:middle; border: 1px solid black;text-align:center; font-weight: 600;padding: 7px 0;"></td>
                    </tr>
                </tfoot>
            </table>
        </div>

    </div>
    <br />
    <u class="col-md-12 float-left" style="padding-top:1%;font-weight:bold;font-style:italic;">
        Ghi chú:
    </u>
    <div class="col-md-12 float-left">
        <span style="font-style:italic;padding-left:16px"> - Biên bản này được lập thành 03 bản có giá trị như nhau, mỗi bên giữ 01 bản.</span>
    </div>
    <div class="col-md-12 float-left">
        <span style="font-style:italic;padding-left:16px"> - Số mẻ ghi theo số mẻ quy định của P.QLCL.</span>
    </div>
    <div class="col-md-12 float-left">
        <span style="font-style:italic;padding-left:16px"> - Khối lượng gang thỏi lấy bằng 90% khối lượng gang lỏng tính theo cân ray.</span>
    </div>
    <div class="col-md-12 float-left">
        <span style="font-style:italic;padding-left:16px"> - P.QLCL chỉ xác nhận phân loại gang lỏng.</span>
    </div>

    @* @if (ID_BBGN.ID_TrangThai_BBGN == 1) *@
    @* { *@
    <div class="col-lg-12" style="text-align: left;height: 150px;display: flex;">
        <div class="col-xxl-4 col-md-4" style="width: 70%;font-weight:bold;font-size:15px">

            <div style="text-align: center;  padding-top:8px;">
                P.QLCL
            </div>
            @for (int i = 0; i < Model.NguoiXacNhan.Count; i += 2)
            {
                <div style="display: flex; width: 100%;">
                    @for (int j = i; j < i + 2 && j < Model.NguoiXacNhan.Count; j++)
                    {
                        var nguoi = Model.NguoiXacNhan[j];
                        <div style="width: 50%; text-align: center; padding: 10px;">
                            <div style="padding-bottom: 6px;">
                                @if (!string.IsNullOrEmpty(nguoi.ChuKy))
                                {
                                    var urlChuKy = "https://report.hoaphatdungquat.vn" + nguoi.ChuKy;
                                    <img src="@urlChuKy" alt="Chữ ký" height="50" />
                                }
                                else
                                {
                                    <img src="https://report.hoaphatdungquat.vn/img/logoHP.png" alt="Logo" height="50" />
                                }
                            </div>
                            <div style="font-weight: bold;">
                                @nguoi.HoVaTen
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
        <div class="col-xxl-4 col-md-4" style="width: 70%; font-weight:bold; font-size:15px">
            <div style="text-align: center; padding-top:8px;">
                NM.LT
            </div>

            @for (int i = 0; i < Model.NguoiNhan.Count; i += 2)
            {
                <div style="display: flex; width: 100%;">
                    @for (int j = i; j < i + 2 && j < Model.NguoiNhan.Count; j++)
                    {
                        var nguoi = Model.NguoiNhan[j];
                        <div style="width: 50%; text-align: center; padding: 10px;">
                            <div style="padding-bottom: 6px;">
                                @if (!string.IsNullOrEmpty(nguoi.ChuKy))
                                {
                                    var urlChuKy = "https://report.hoaphatdungquat.vn" + nguoi.ChuKy;
                                    <img src="@urlChuKy" alt="Chữ ký" height="50" />
                                }
                                else
                                {
                                    <img src="https://report.hoaphatdungquat.vn/img/logoHP.png" alt="Logo" height="50" />
                                }
                            </div>
                            <div style="font-weight: bold;">
                                @nguoi.HoVaTen
                            </div>
                        </div>
                    }
                </div>
            }
        </div>

        
        <div class="col-xxl-4 col-md-4" style="width: 70%;font-weight:bold;font-size:15px">

            <div style="text-align: center; padding-top:8px;">
                NM.LG
            </div>
            @for (int i = 0; i < Model.NguoiChuyen.Count; i += 2)
            {
                <div style="display: flex; width: 100%;">
                    @for (int j = i; j < i + 2 && j < Model.NguoiChuyen.Count; j++)
                    {
                        var nguoi = Model.NguoiChuyen[j];
                        <div style="width: 50%; text-align: center; padding: 10px;">
                            <div style="padding-bottom: 6px;">
                                @if (!string.IsNullOrEmpty(nguoi.ChuKy))
                                {
                                    var urlChuKy = "https://report.hoaphatdungquat.vn" + nguoi.ChuKy;
                                    <img src="@urlChuKy" alt="Chữ ký" height="50" />
                                }
                                else
                                {
                                    <img src="https://report.hoaphatdungquat.vn/img/logoHP.png" alt="Logo" height="50" />
                                }
                            </div>
                            <div style="font-weight: bold;">
                                @nguoi.HoVaTen
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
    </div>

    <!-- End Recent Sales -->
    @* } *@
</div>

